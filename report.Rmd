# National Poll on Healthy Aging (NPHA)

## Auteurs du Projet
[Anastasios Tsiompanidis](anastasios.tsiompanidis@etu.univ-grenoble-alpes.fr)
[Noah Kohrs](noah.kohrs@etu.univ-grenoble-alpes.fr)


## 1- Motivation et Positionnement du Projet
L'objectif de cette analyse est de développer et de valider des algorithmes de machine learning capables de prédire le nombre de médecins consultés par une personne âgée au cours d'une année, en se basant sur un sous-ensemble filtré des données du National Poll on Healthy Aging (NPHA). Ce projet est crucial pour comprendre les besoins spécifiques des seniors en matière de santé et pour fournir des informations utiles aux prestataires de soins, aux décideurs politiques et aux défenseurs des intérêts des personnes âgées. Cette étude contribue à une meilleure gestion des ressources médicales et à l'amélioration des politiques publiques axées sur le vieillissement.

## 2- Analyse descriptive 
```{r}
npha <- read.csv("C:/Users/noah/Documents/AAACode/SD/Project/NPHA-doctor-visits.csv")
summary(npha)
```

Comme nos valeurs sont des catégorielles représentées par des chiffres, on va les remplacer par des labels pour une meilleure compréhension.

On va d'abord définir les labels pour chaque variable catégorielle.

Note: Le dataset utilisé possède un certain nombre d'erreurs dans le labelling qu'il fourni qui nous oblige à le réarranger.
```{r}
doctor_labels <- c("0-1", "2-3", "4 or more")
age_labels <- c("50-64", "65-80")

# On a ajouté la valeur "Very Poor" nous mêmes car il n'y avait pas de labelling indiqué pour la valeur 6. 
# Celà suit la logique et nous évite la présence de NA's 
health_labels <- c("Refused", "Excellent", "Very Good", "Good", "Fair", "Poor", "Very Poor")
empl_labels <- c("Refused", "Full-time", "Part-time", "Retired", "Not working")
yes_no_labels <- c("No", "Yes")
gender_labels <- c("M", "F")
medication_labels <- c("Refused", "Use regularly", "Use occasionally", "Do not use")

# It is supposed tob e No and yes; but the dataset is wrongly labeled here. 
# We will assume these are the correct labels
sleep_labels <- c("Refused", "No", "A bit", "Yes")
race_labels <- c("Not asked", "Refused", "White", "Black", "Other", "Hispanic", "2+ Races")
```

```{r}
colnames(npha)
npha$Number.of.Doctors.Visited = factor(npha$Number.of.Doctors.Visited, levels = 1:3, labels = doctor_labels, ordered = TRUE)
npha$Age = factor(npha$Age, levels = 1:2, labels = age_labels, ordered = FALSE)
npha$Physical.Health = factor(npha$Physical.Health, levels = c(-1, 1:6), labels = health_labels, ordered = TRUE)
npha$Mental.Health = factor(npha$Mental.Health, levels = c(-1, 1:6), labels = health_labels, ordered = TRUE)
npha$Dental.Health = factor(npha$Dental.Health, levels = c(-1, 1:6), labels = health_labels, ordered = TRUE)
npha$Employment = factor(npha$Employment, levels = c(-1, 1:4), labels = empl_labels, ordered = FALSE)
npha$Stress.Keeps.Patient.from.Sleeping = factor(npha$Stress.Keeps.Patient.from.Sleeping, levels = 0:1, labels = yes_no_labels, ordered = FALSE)
npha$Medication.Keeps.Patient.from.Sleeping = factor(npha$Medication.Keeps.Patient.from.Sleeping, levels = 0:1, labels = yes_no_labels, ordered = FALSE)
npha$Pain.Keeps.Patient.from.Sleeping = factor(npha$Pain.Keeps.Patient.from.Sleeping, levels = 0:1, labels = yes_no_labels, ordered = FALSE)
npha$Bathroom.Needs.Keeps.Patient.from.Sleeping = factor(npha$Bathroom.Needs.Keeps.Patient.from.Sleeping, levels = 0:1, labels = yes_no_labels, ordered = FALSE)
npha$Unknown.Keeps.Patient.from.Sleeping = factor(npha$Unknown.Keeps.Patient.from.Sleeping, levels = 0:1, labels = yes_no_labels, ordered = FALSE)
npha$Trouble.Sleeping = factor(npha$Trouble.Sleeping, levels = c(-1, 1:3), labels = sleep_labels, ordered = FALSE)
npha$Prescription.Sleep.Medication = factor(npha$Prescription.Sleep.Medication, levels = c(-1, 1:3), labels = medication_labels, ordered = FALSE)
npha$Race = factor(npha$Race, levels = 0:6, labels = race_labels, ordered = FALSE)
npha$Gender = factor(npha$Gender, levels = 1:2, labels = gender_labels, ordered = FALSE)

```
On obtient:

```{r}
summary(npha)
```

On observe que l'age des patients est toujours entre 65 et 80 ans, il s'agit donc d'une variable constante sur notre jeu de données. 
Nous allons donc l'écarter de la suite de l'analyse car cela ne nous fourni aucune information utile.

On fait alors:
```{r}
npha <- npha[, c(1, 3:ncol(npha))]
# On vérifie que tout s'est bien passé
colnames(npha)
```

On observe également que la variable Dental.Health contient des valeurs inconnues qui ne sont associées à aucun label. 
Nous allons donc les remplacer par des valeurs manquantes.

Essayons d'avoir une vue d'ensemble de nos données.
```{r}
plot(npha)
```
Comme attendu, c'est indigeste en vu du nombre de variables présentes dans le jeun de donnée.

On va donc essayer de voir les relations entre les variables et le nombre de visites chez le médecin.

```{r}

par(mfrow = c(2, 2))
# boxplot(split(npha$Number.of.Doctors.Visited, npha$Age), main = "Number of Doctors Visited by Age Group")
# Ceci même si en théorie est intéressant, ne donne pas de résultats utiles car on a seulement 1 variable qui existe dans la base de données

boxplot(split(npha$Number.of.Doctors.Visited, npha$Employment), main = "Number of Doctors Visited by Employement Group")
boxplot(split(npha$Number.of.Doctors.Visited, npha$Physical.Health), main = "Number of Doctors Visited by Physical Health")   
boxplot(split(npha$Number.of.Doctors.Visited, npha$Mental.Health), main = "Number of Doctors Visited by Mental Health")
boxplot(split(npha$Number.of.Doctors.Visited, npha$Dental.Health), main = "Number of Doctors Visited by Dental Health")
```

## 3- Classification non supervisée :
```{r}
par(mfrow = c(1, 1))
library(cluster)
### Suppression de la variable cible (Number.of.Doctors.Visited)
npha_sans_visites <- npha[, -1]
summary(npha_sans_visites)

dist_matrix <- daisy(npha_sans_visites[, -ncol(npha_sans_visites)])
hclust_result <- hclust(dist_matrix)
plot(hclust_result)

pam_result <- pam(npha_sans_visites[, -ncol(npha_sans_visites)], k = 2)
plot(pam_result)
```

## 4- Classification supervisée :
```{r}
library(rpart)
# Indices pour chaque catégorie
# Ici aucun class est assez rare pour faire un max d'une classe

indices_1 <- which(npha$Number.of.Doctors.Visited == "0-1")
indices_2 <- which(npha$Number.of.Doctors.Visited == "2-3")
indices_3 <- which(npha$Number.of.Doctors.Visited == "4 or more")

sample_1 <- sample(indices_1, round(0.6 * length(indices_1), digits = 0))
sample_2 <- sample(indices_2, round(0.6 * length(indices_2), digits = 0))
sample_3 <- sample(indices_3, round(0.6 * length(indices_3), digits = 0))

sub <- c(sample_1, sample_2, sample_3)
length(sample_1)
length(indices_1)
length(sample_2)
length(sample_3)
all(sub %in% 1:nrow(npha))  # Should return TRUE

fit <- rpart(npha$Number.of.Doctors.Visited ~ ., data = npha, subset = sub)
fit
plot(fit)
res <- table(predict(fit, npha[-sub, ], type = "class"), npha[-sub, "Number.of.Doctors.Visited"])
res
err <- (1 - sum(diag(res)) / sum(res)) * 100
print("Le taux d'erreur est de : ")
print(err)
```

#Daisy | PAM CAH
